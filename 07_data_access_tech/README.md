# 데이터 접근 기술 - Basic

## SQLMapper
###### 개발자가 SQL만 작성하면 SQL 결과를 알아서 매핑해준다.
- JdbcTemplate 
###### (중복 제거, 기타 편의 기능)
- MyBatis

## ORM 관련 기술
###### SQL을 직접 작성할 필요 없으며, 객체를 자바 컬렉션에 저장하여 조회하듯이 사용하면 ORM 기술이 DB에서 해당 객체를 저장하고 조회해준다.
- JPA, Hibernate 
###### (JPA 인터페이스는 자바 진영의 ORM 표준이며, Hibernate(하이버네이트)는 JPA에서 가장 많이 사용하는 구현체)
- 스프링 데이터 JPA 
###### (JPA를 더 편리하게 사용할 수 있게 도와주는 프로젝트 1 : 거의 필수)
- Querydsl 
###### (JPA를 더 편리하게 사용할 수 있게 도와주는 프로젝트 2 : 거의 필수)

## DTO(data transfer object) :: 데이터 전송 객체
- 데이터의 주 목적이 데이터를 전달만 하는 용도로 사용되는 객체를 뜻한다.
- 이전에 설명한 ItemSearchCond 도 DTO 역할을 하지만, 이 프로젝트에서 Cond 는 검색 조건으로 사용한다는 규칙을 정했다.
> (참고로 이런 규칙은 정해진 것이 없기 때문에 해당 프로젝트 안에서 일관성 있게 규칙을 정하면 된다.)

## 프로젝트 Application 개요
```java
@Import(MemoryConfig.class)
@SpringBootApplication(scanBasePackages = "hello.itemservice.web")
public class ItemServiceApplication {
  public static void main(String[] args) {
    SpringApplication.run(ItemServiceApplication.class, args);
  }
  @Bean
  @Profile("local")
  public TestDataInit testDataInit(ItemRepository itemRepository) {
    return new TestDataInit(itemRepository);
  }
}
```

#### @Import(MemoryConfig.class)
- 직접 Bean을 등록하여 설정파일을 import 해오는 어노테이션.
```java
@Configuration
public class MemoryConfig {

    @Bean
    public ItemService itemService() {
        return new ItemServiceV1(itemRepository());
    }

    @Bean
    public ItemRepository itemRepository() {
        return new MemoryItemRepository();
    }

}
```

#### @Profile("local")
- application.properties 에서 원하는 프로필을 지정할 수 있다.
```properties
spring.profiles.active=local
```

#### @EventListener(ApplicationReadyEvent.class)
- 스프링 컨테이너가 완전히 초기화를 다 끝내고, 실행 준비가 되었을 때 발생하는 이벤트이다. 다음은 예시이다.
```java
@Slf4j
@RequiredArgsConstructor
public class TestDataInit {

    private final ItemRepository itemRepository;

    /**
     * 확인용 초기 데이터 추가
     */
    @EventListener(ApplicationReadyEvent.class)
    public void initData() {
        log.info("test data init");
        itemRepository.save(new Item("itemA", 10000, 10));
        itemRepository.save(new Item("itemB", 20000, 20));
    }

}
```

## generated by default as identity
- identity 전략이라고 하는데, 기본 키 생성을 데이터베이스에 위임하는 방법이다. MySQL의 Auto Increment와 같은 방법이다.
- 여기서 PK로 사용되는 id 는 개발자가 직접 지정하는 것이 아니라 비워두고 저장하면 된다. 그러면 데이터베이스가 순서대로 증가하는 값을 사용해서 넣어준다.

## 테이블의 기본 키를 선택하는 전략은 크게 2가지가 있다.

#### 자연 키(natural key)
- 비즈니스에 의미가 있는 키
> 예: 주민등록번호, 이메일, 전화번호

#### 대리 키(surrogate key) : 실무 권장
- 비즈니스와 관련 없는 임의로 만들어진 키, 대체 키로도 불린다.
> 예: 오라클 시퀀스, auto_increment, identity, 키생성 테이블 사용
